<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head th:replace="header :: copy"></head>
<body ng-app="storeApp" class="ng-cloak">
<nav th:replace="menubar :: copy"></nav>

<!-- Content container -->
<div ng-controller="StoreController" data-ng-init="init()">
  <div class="container">
    <!-- Filter section -->
    <div class="col-md-3">
      <h4>Filters</h4>
      <div class="media" ng-repeat="item in availableFilters">
        <div class="media-left">
          <i class="glyphicon glyphicon-plus"
             role="button"
             data-toggle="collapse"
             data-target="#collapse{{ $index }}"
             ng-click="toggleFilterSourceIcon($event.currentTarget)"></i>
        </div>
          <div class="media-body">
            <span>{{ item.name }}</span>
            <div id="collapse{{ $index }}" class="collapse">
              <div class="checkbox" ng-repeat="child in item.children">
                <label>
                  <input type="checkbox"
                         ng-checked="filtersSelected.indexOf(child) > -1"
                         ng-click="toggleFilterSelection(child)" /> {{ child.name }}
                </label>
              </div>
            </div>
          </div>
      </div>
      <br />
      <span class="pull-right">
        <button class="btn btn-default btn-sm" ng-click="clearFilters()">Clear Filters</button>
        <button class="btn btn-primary btn-sm" ng-click="applyFilters()">Apply Filters</button>
      </span>
    </div>
    <!-- End of filter section -->
    <!-- Start of store section -->
    <div class="col-md-6">
      <div class="panel panel-default panel-not-rounded">
        <div class="panel-heading">
          <!-- Breadcrumb heading -->
          <ol class="breadcrumb breadcrumb-header">
            <li ng-repeat="item in buildBreadcrumb() track by $index" ng-class="{ active: $last }">
              <a href="#" ng-if="$first &amp;&amp; !$last" ng-click="moveToBreadcrumbIndex($index)">hawaii.edu :
                store</a>
              <span href="#" ng-if="$first &amp;&amp; $last">hawaii.edu : store</span>
              <a href="#" ng-if="$middle" ng-click="moveToBreadcrumbIndex($index)">{{ item }}</a>
              <span ng-if="!$first &amp;&amp; $last">{{ item }}</span>
            </li>
          </ol>
          <!-- End of breadcrumb heading -->
        </div>
        <div class="panel-body">
          <h1 style="margin-top: -5px;">{{ currentLocationName }}</h1>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
            labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco
            laboris nisi ut aliquip ex ea commodo consequat.
          </p>
          <!-- Search bar for finding groups -->
          <form ng-submit="searchForGroups()">
            <div class="input-group">
              <input type="text" ng-model="searchQuery" class="form-control"
                     placeholder="Search for groups by name..." />
              <span class="input-group-btn">
                <button class="btn btn-primary" type="button">
                  <i class="glyphicon glyphicon-search"></i>
               </button>
              </span>
            </div>
          </form>
          <!-- End of search bar -->
          <table class="table table-striped table-hover" style="table-layout: fixed; word-wrap: break-word;">
            <thead>
            <tr>
              <th>Name</th>
              <th ng-if="isSearching">Path</th>
            </tr>
            </thead>
            <!-- Table body when navigating throughout the store -->
            <tbody ng-if="!isSearching">
            <tr ng-if="!isUserAtHome()">
              <td>
                <i class="fa fa-chevron-up"></i>
                <a href="#" ng-click="moveBackOnePath()">Go back to the previous folder</a>
              </td>
            </tr>
            <!-- Sort the items such that folders appear first, then groups -->
            <tr ng-repeat="item in itemsInCurrentLocation | orderBy: '-type'">
              <td ng-if="item.type === 'stem'">
                <i class="fa fa-folder"></i>
                <a href="#" ng-click="goToPath(item.name)">{{ item.extension }}</a>
              </td>
              <td ng-if="item.type === 'group'">
                <i class="fa fa-group"></i>
                <a href="#" ng-click="addToCart(item)">{{ item.extension }}</a>
              </td>
            </tr>
            </tbody>
            <!-- Table body after applying filters, or searching for groups using search bar -->
            <tbody ng-if="isSearching">
            <tr ng-repeat="item in itemsInCurrentLocation">
              <td ng-if="item.type === 'stem'">
                <i class="fa fa-folder"></i>
                <a href="#" ng-click="goToPath(item.name)">{{ item.extension }}</a>
              </td>
              <td ng-if="item.type === 'group'">
                <i class="fa fa-group"></i>
                <a href="#" ng-click="addToCart(item)">{{ item.extension }}</a>
              </td>
              <!-- Path to the item -->
              <td>{{ item.name }}</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
      <!-- End of store section -->
    </div>
    <!-- Cart section -->
    <div class="col-md-3">
      <div class="panel panel-default panel-not-rounded">
        <div class="panel-heading">
          <h3 class="panel-title">Cart</h3>
        </div>
        <div class="panel-body" ng-if="getAmountInCart() === 0">
          Your cart is currently empty
        </div>
        <div class="list-group" ng-if="getAmountInCart() > 0">
          <div class="list-group-item" ng-repeat="group in getGroupsInCart()">
            <div class="media-body" style="font-size: 12.5px;">
              <span data-toggle="tooltip" data-placement="left" title="{{ group.name }}">{{ group.extension }}</span>
            </div>
            <div class="media-right media-middle">
              <button class="btn btn-xs btn-danger" ng-click="removeFromCart(group)">
                <i class="fa fa-remove"></i>
              </button>
            </div>
          </div>
        </div>
        <div class="panel-footer clearfix" ng-if="getAmountInCart() > 0">
          <button type="button" class="btn btn-primary btn-sm pull-right" data-toggle="modal" data-target="#myModal">
            Relationship Mapping
          </button>
        </div>
      </div>
      <!-- Modal -->
      <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog modal-lg">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Relationship Mapping</h4>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col-sm-6">
                  <div id="venn">
                    <div id="c1" class="circle">
                      <p>Group A</p>
                      <div id="collection" ondrop="drop(event)" ondragover="allowDrop(event)" class="ans1"></div>
                    </div>
                    <div id="c2" class="circle">
                      <p>Group B</p>
                      <div id="collection" ondrop="drop(event)" ondragover="allowDrop(event)" class="ans2"></div>
                    </div>
                    <div id="c3" class="circle">
                      <p>Group C</p>
                      <div id="collection" ondrop="drop(event)" ondragover="allowDrop(event)" class="ans3"></div>
                    </div>
                    <div id="j12" class="joined">
                      <p>Both</p>
                      <div id="collection" ondrop="drop(event)" ondragover="allowDrop(event)" class="both"></div>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6">
                  <div class="list-group" ng-if="getAmountInCart() > 0">
                    <div class="list-group-item" ng-repeat="group in getGroupsInCart()">
                      <div class="media-body" data-toggle="tooltip">
                        <strong>Group:</strong> {{ group.name }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- End of cart section -->
  </div>
</div>
<div th:replace="footer :: copy"></div>
</body>
</html>
